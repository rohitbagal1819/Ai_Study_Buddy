<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>StudyBuddy - Quiz Module (Fully Working)</title>
  <link rel="stylesheet" href="shared-styles.css">

  <style>
    :root {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text2: #64748b;
      --accent: #6366f1;
      --accent-dark: #4f46e5;
      --green: #10b981;
      --red: #ef4444;
      --border: #e2e8f0;
      --pending: #f59e0b;
      --created: #2563eb;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
      /* removed padding:24px from body - moved to container with adjustment */
    }

    /* ── ONLY CHANGES ARE THESE LINES ── */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
      padding-left: 280px;           /* ← space for left sidebar (adjust this value if needed) */
    }

    @media (max-width: 1024px) {
      .container {
        padding-left: 24px;
        padding-right: 24px;
      }
    }
    /* ── End of changes ── */

    h1 { font-size: 2.1rem; margin-bottom: 1.5rem; }
    h2 { margin-bottom: 1.25rem; }
    .filters {
      display: flex;
      gap: 12px;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      align-items: center;
    }
    .filter-btn {
      padding: 10px 20px;
      border-radius: 9999px;
      border: 1px solid var(--border);
      background: white;
      color: var(--text2);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.18s;
    }
    .filter-btn.active, .filter-btn:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2.5rem;
    }
    .stat-card {
      background: var(--card);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      text-align: center;
    }
    .stat-value { font-size: 2.25rem; font-weight: 700; margin-bottom: 0.25rem; }
    .stat-label { color: var(--text2); font-size: 0.95rem; }
    .quiz-list { display: grid; gap: 1.25rem; }
    .quiz-card {
      background: var(--card);
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.07);
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .quiz-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }
    .quiz-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.75rem; }
    .quiz-meta {
      display: flex;
      gap: 1.2rem;
      font-size: 0.9rem;
      color: var(--text2);
      flex-wrap: wrap;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    .badge-subject { background:#e0e7ff; color:#4f46e5; }
    .badge-pending  { background:#fef3c7; color:#d97706; }
    .badge-attempted{ background:#d1fae5; color:#059669; }
    .badge-created  { background:#dbeafe; color:#2563eb; }
    .quiz-actions {
      display: flex;
      gap: 12px;
      margin-top: 0.75rem;
      flex-wrap: wrap;
    }
    .btn {
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.16s;
    }
    .btn-primary { background: var(--accent); color: white; }
    .btn-primary:hover { background: var(--accent-dark); }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
    .btn-outline:hover { background: #f1f5f9; }
    #attempt-screen, #results-screen, #create-screen {
      display: none;
      background: var(--card);
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }
    .question {
      margin: 1.5rem 0;
      padding: 1.5rem;
      background: #f8fafc;
      border-radius: 10px;
    }
    .options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 1.2rem;
    }
    .option {
      padding: 14px 18px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.14s;
    }
    .option:hover { border-color: var(--accent); background: #f0f4ff; }
    .option.selected { border-color: var(--accent); background: #e0e7ff; font-weight: 500; }
    .progress {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
    }
    .progress-bar {
      flex: 1;
      height: 8px;
      background: #e2e8f0;
      border-radius: 999px;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 999px;
      width: 0;
      transition: width 0.3s;
    }
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
    }
    .score-big {
      font-size: 3.5rem;
      font-weight: 800;
      text-align: center;
      margin: 1rem 0;
    }
    .explanation {
      margin-top: 1rem;
      padding: 1rem;
      background: #f1f5f9;
      border-radius: 8px;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .form-group { margin-bottom: 1.5rem; }
    label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
    }
    .question-form {
      border: 1px solid var(--border);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .option-inputs {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .option-row { display: flex; gap: 12px; }
    .option-row input { flex: 1; }
    #questions-list { margin-top: 1.5rem; }
  </style>
</head>
<body>

<div class="container">
  <h1>Quizzes</h1>

  <div class="filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="created">Created</button>
    <button class="filter-btn" data-filter="attempted">Attempted</button>
    <button class="filter-btn" data-filter="pending">Pending</button>
    <button class="btn btn-primary" id="create-quiz-btn" style="margin-left: auto;">+ Create Quiz</button>
  </div>

  <div class="stats">
    <div class="stat-card"><div class="stat-value" id="stat-taken">0</div><div class="stat-label">Taken</div></div>
    <div class="stat-card"><div class="stat-value" id="stat-avg">0%</div><div class="stat-label">Avg Score</div></div>
    <div class="stat-card"><div class="stat-value" id="stat-pending">0</div><div class="stat-label">Pending</div></div>
  </div>

  <div class="quiz-list" id="quizList"></div>

  <!-- Attempt Screen -->
  <div id="attempt-screen">
    <button class="btn btn-outline" id="back-to-list">← Back to List</button>
    <h2 id="quiz-title-attempt"></h2>
    <div class="progress">
      <div>Question <span id="current-q-num">1</span> of <span id="total-q">?</span></div>
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
    </div>
    <div id="current-question"></div>
    <div class="nav-buttons">
      <button class="btn btn-outline" id="prev-q" disabled>Previous</button>
      <button class="btn btn-outline" id="next-q">Next</button>
      <button class="btn btn-primary" id="submit-quiz" style="display:none;">Submit Quiz</button>
    </div>
  </div>

  <!-- Results Screen -->
  <div id="results-screen">
    <button class="btn btn-outline" id="back-from-results">← Back to List</button>
    <h2 id="quiz-title-results"></h2>
    <div class="score-big" id="score-display">--</div>
    <p style="text-align:center; color:var(--text2);">Your Score</p>
    <div id="results-detail"></div>
    <div style="margin-top:2rem; text-align:center;">
      <button class="btn btn-primary" id="reattempt-btn">Re-attempt Quiz</button>
    </div>
  </div>

  <!-- Create Screen -->
  <div id="create-screen">
    <button class="btn btn-outline" id="back-from-create">← Back to List</button>
    <h2>Create New Quiz</h2>
    <div class="form-group">
      <label for="quiz-title">Quiz Title</label>
      <input type="text" id="quiz-title" placeholder="Enter quiz title">
    </div>
    <div class="form-group">
      <label for="quiz-subject">Subject</label>
      <input type="text" id="quiz-subject" placeholder="Enter subject">
    </div>
    <h3>Questions</h3>
    <div id="questions-list"></div>
    <button class="btn btn-outline" id="add-question">+ Add Question</button>
    <div style="margin-top:2rem; text-align:right;">
      <button class="btn btn-primary" id="save-quiz">Save Quiz</button>
    </div>
  </div>
</div>

<script src="shared-component.js"></script>
<script>
// ────────────────────────────────────────────────
// Data – Complete sample quizzes (so you can test immediately)
// ────────────────────────────────────────────────
let quizzes = JSON.parse(localStorage.getItem('quizzes')) || [
  {
    id: 1,
    title: "Biology - Cell Structure",
    subject: "Biology",
    created: false,
    questions: [
      { id: 1, text: "Powerhouse of the cell?", options: {A:"Nucleus",B:"Mitochondria",C:"Ribosome",D:"Golgi"}, correct: "B", explanation: "Mitochondria produce ATP." },
      { id: 2, text: "Protein synthesis organelle?", options: {A:"Golgi",B:"Lysosome",C:"Ribosome",D:"ER"}, correct: "C", explanation: "Ribosomes build proteins." },
      { id: 3, text: "Cell membrane function?", options: {A:"Store DNA",B:"Control entry/exit",C:"Energy production",D:"Lipid synthesis"}, correct: "B", explanation: "Selective barrier." }
    ]
  },
  {
    id: 2,
    title: "Physics - Newton's Laws",
    subject: "Physics",
    created: false,
    questions: [
      { id: 1, text: "First Law is?", options: {A:"F=ma",B:"Inertia",C:"Action-Reaction",D:"Gravity"}, correct: "B", explanation: "Object stays at rest or motion unless force acts." },
      { id: 2, text: "F = ma is which law?", options: {A:"First",B:"Second",C:"Third",D:"None"}, correct: "B", explanation: "Newton's Second Law." }
    ]
  }
];

// ────────────────────────────────────────────────
// Save functions
// ────────────────────────────────────────────────
function saveQuizzes() { localStorage.setItem('quizzes', JSON.stringify(quizzes)); }
function saveUserData() { localStorage.setItem('quizUserData', JSON.stringify(userData)); }

// ────────────────────────────────────────────────
// User data
// ────────────────────────────────────────────────
let userData = JSON.parse(localStorage.getItem('quizUserData')) || {
  saved: [],
  attempts: {}
};

function getStatus(quizId) {
  if (userData.attempts[quizId]?.length > 0) return 'attempted';
  if (userData.saved.includes(quizId)) return 'pending';
  return 'available';
}

function getBestScore(quizId) {
  const attempts = userData.attempts[quizId] || [];
  return attempts.length ? Math.max(...attempts.map(a => a.score)) : null;
}

function updateStats() {
  const attempted = Object.keys(userData.attempts).length;
  const totalScores = Object.values(userData.attempts).flat().map(a => a.score);
  const avgScore = totalScores.length ? (totalScores.reduce((a,b)=>a+b,0)/totalScores.length).toFixed(0) : 0;
  const pending = userData.saved.filter(id => !userData.attempts[id]).length;

  document.getElementById('stat-taken').textContent = attempted;
  document.getElementById('stat-avg').textContent = avgScore + '%';
  document.getElementById('stat-pending').textContent = pending;
}

// ────────────────────────────────────────────────
// Render quizzes
// ────────────────────────────────────────────────
function renderQuizzes(filter = "all") {
  const list = document.getElementById("quizList");
  list.innerHTML = "";

  const filtered = quizzes.filter(q => {
    const status = getStatus(q.id);
    if (filter === "all") return true;
    if (filter === "created") return q.created;
    if (filter === "attempted") return status === "attempted";
    if (filter === "pending") return status === "pending";
    return true;
  });

  if (filtered.length === 0) {
    list.innerHTML = `<p style="text-align:center; color:var(--text2); padding:3rem 0;">No quizzes found.</p>`;
    return;
  }

  filtered.forEach(q => {
    const status = getStatus(q.id);
    const bestScore = getBestScore(q.id);
    const attempts = (userData.attempts[q.id] || []).length;

    const card = document.createElement("div");
    card.className = "quiz-card";

    let badges = "";
    if (q.created) badges += `<span class="badge badge-created">Created</span>`;
    if (status === "pending") badges += `<span class="badge badge-pending">Pending</span>`;
    if (status === "attempted") badges += `<span class="badge badge-attempted">Attempted</span>`;

    card.innerHTML = `
      <div class="quiz-title">${q.title}</div>
      <div class="quiz-meta">
        <span class="badge badge-subject">${q.subject}</span>
        ${badges}
        <span>${q.questions.length} questions</span>
        ${bestScore ? `<span>Best: ${bestScore}%</span>` : ""}
        ${attempts ? `<span>Attempts: ${attempts}</span>` : ""}
      </div>
      <div class="quiz-actions">
        ${status === "available" ? `<button class="btn btn-outline save-quiz" data-id="${q.id}">Save for Later</button>` : ""}
        ${status === "pending" ? `
          <button class="btn btn-primary start-quiz" data-id="${q.id}">Start Quiz</button>
          <button class="btn btn-outline remove-pending" data-id="${q.id}">Remove</button>
        ` : ""}
        ${status === "attempted" ? `
          <button class="btn btn-primary view-results" data-id="${q.id}">View Results</button>
          <button class="btn btn-outline reattempt" data-id="${q.id}">Re-attempt</button>
        ` : ""}
        ${q.created ? `
          <button class="btn btn-outline edit-quiz" data-id="${q.id}">Edit</button>
          <button class="btn btn-outline delete-quiz" data-id="${q.id}" style="color:var(--red);">Delete</button>
        ` : ""}
      </div>
    `;
    list.appendChild(card);
  });

  updateStats();
}

// ────────────────────────────────────────────────
// Attempt logic
// ────────────────────────────────────────────────
let currentQuiz = null;
let currentQuestionIndex = 0;
let userAnswers = {};

function startAttempt(quizId, isReattempt = false) {
  currentQuiz = quizzes.find(q => q.id === quizId);
  if (!currentQuiz) return alert("Quiz not found");

  currentQuestionIndex = 0;
  userAnswers = {};

  document.getElementById("quizList").style.display = "none";
  document.getElementById("attempt-screen").style.display = "block";
  document.getElementById("quiz-title-attempt").textContent = currentQuiz.title;
  document.getElementById("total-q").textContent = currentQuiz.questions.length;

  renderQuestion();
}

function renderQuestion() {
  const q = currentQuiz.questions[currentQuestionIndex];
  document.getElementById("current-q-num").textContent = currentQuestionIndex + 1;

  let html = `
    <div class="question">
      <strong>Question ${currentQuestionIndex + 1}</strong>
      <p>${q.text}</p>
      <div class="options">
  `;

  for (const [key, val] of Object.entries(q.options)) {
    html += `<div class="option" data-answer="${key}">${key}) ${val}</div>`;
  }

  html += `</div></div>`;

  document.getElementById("current-question").innerHTML = html;

  if (userAnswers[q.id]) {
    document.querySelector(`.option[data-answer="${userAnswers[q.id]}"]`)?.classList.add("selected");
  }

  document.querySelectorAll(".option").forEach(el => {
    el.addEventListener("click", () => {
      document.querySelectorAll(".option").forEach(o => o.classList.remove("selected"));
      el.classList.add("selected");
      userAnswers[q.id] = el.dataset.answer;
    });
  });

  document.getElementById("prev-q").disabled = currentQuestionIndex === 0;
  document.getElementById("next-q").style.display = currentQuestionIndex < currentQuiz.questions.length - 1 ? "block" : "none";
  document.getElementById("submit-quiz").style.display = currentQuestionIndex === currentQuiz.questions.length - 1 ? "block" : "none";

  const progress = ((currentQuestionIndex + 1) / currentQuiz.questions.length) * 100;
  document.getElementById("progress-fill").style.width = progress + "%";
}

document.getElementById("prev-q")?.addEventListener("click", () => {
  if (currentQuestionIndex > 0) {
    currentQuestionIndex--;
    renderQuestion();
  }
});

document.getElementById("next-q")?.addEventListener("click", () => {
  if (currentQuestionIndex < currentQuiz.questions.length - 1) {
    currentQuestionIndex++;
    renderQuestion();
  }
});

document.getElementById("submit-quiz")?.addEventListener("click", submitQuiz);

function submitQuiz() {
  let correctCount = 0;
  currentQuiz.questions.forEach(q => {
    if (userAnswers[q.id] === q.correct) correctCount++;
  });
  const score = Math.round((correctCount / currentQuiz.questions.length) * 100);

  if (!userData.attempts[currentQuiz.id]) userData.attempts[currentQuiz.id] = [];
  userData.attempts[currentQuiz.id].push({ score, answers: {...userAnswers}, date: new Date().toISOString() });

  userData.saved = userData.saved.filter(id => id !== currentQuiz.id);
  saveUserData();

  showResults(score);
}

function showResults(score) {
  document.getElementById("attempt-screen").style.display = "none";
  document.getElementById("results-screen").style.display = "block";

  document.getElementById("quiz-title-results").textContent = currentQuiz.title;
  document.getElementById("score-display").textContent = score + "%";
  document.getElementById("score-display").style.color = score >= 80 ? "var(--green)" : score >= 60 ? "var(--pending)" : "var(--red)";

  let html = `<h3 style="margin:1.5rem 0 1rem;">Results</h3>`;
  currentQuiz.questions.forEach(q => {
    const ans = userAnswers[q.id] || "—";
    const correct = q.correct;
    const isCorrect = ans === correct;
    html += `
      <div class="question">
        <strong>${q.text}</strong><br>
        Your answer: <strong style="color:${isCorrect?'var(--green)':'var(--red)'}">${ans}) ${q.options[ans] || "—"}</strong> 
        ${isCorrect ? '✓ Correct' : `✗ Wrong (Correct: ${correct})`}
        <div class="explanation">${q.explanation}</div>
      </div>
    `;
  });
  document.getElementById("results-detail").innerHTML = html;
}

// ────────────────────────────────────────────────
// Create Quiz
// ────────────────────────────────────────────────
let editingQuizId = null;
let newQuiz = { title: "", subject: "", questions: [] };
let questionCounter = 1;

function startCreate(isEdit = false, quizId = null) {
  document.getElementById("quizList").style.display = "none";
  document.getElementById("create-screen").style.display = "block";

  if (isEdit && quizId) {
    const quiz = quizzes.find(q => q.id === quizId);
    if (quiz) {
      editingQuizId = quizId;
      newQuiz = { ...quiz };
      document.getElementById("quiz-title").value = quiz.title;
      document.getElementById("quiz-subject").value = quiz.subject;
      questionCounter = quiz.questions.length + 1;
      renderNewQuestions();
    }
  } else {
    editingQuizId = null;
    newQuiz = { title: "", subject: "", questions: [] };
    questionCounter = 1;
    document.getElementById("quiz-title").value = "";
    document.getElementById("quiz-subject").value = "";
    renderNewQuestions();
  }
}

function renderNewQuestions() {
  const container = document.getElementById("questions-list");
  container.innerHTML = "";
  newQuiz.questions.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "question-form";
    div.innerHTML = `
      <div class="form-group"><label>Question ${i+1}</label><input type="text" class="q-text" value="${q.text||''}"></div>
      <div class="option-inputs">
        <label>Options</label>
        <div class="option-row"><input class="opt-a" value="${q.options?.A||''}" placeholder="A"><input class="opt-b" value="${q.options?.B||''}" placeholder="B"></div>
        <div class="option-row"><input class="opt-c" value="${q.options?.C||''}" placeholder="C"><input class="opt-d" value="${q.options?.D||''}" placeholder="D"></div>
      </div>
      <div class="form-group">
        <label>Correct</label>
        <select class="correct">
          <option value="A" ${q.correct==='A'?'selected':''}>A</option>
          <option value="B" ${q.correct==='B'?'selected':''}>B</option>
          <option value="C" ${q.correct==='C'?'selected':''}>C</option>
          <option value="D" ${q.correct==='D'?'selected':''}>D</option>
        </select>
      </div>
      <div class="form-group"><label>Explanation</label><input type="text" class="explanation" value="${q.explanation||''}"></div>
      <button class="btn btn-outline remove-q" data-index="${i}" style="color:var(--red);">Remove</button>
    `;
    container.appendChild(div);
  });
}

document.getElementById("add-question").onclick = () => {
  newQuiz.questions.push({ id: questionCounter++, text:"", options:{A:"",B:"",C:"",D:""}, correct:"A", explanation:"" });
  renderNewQuestions();
};

document.getElementById("save-quiz").onclick = () => {
  newQuiz.title = document.getElementById("quiz-title").value.trim();
  newQuiz.subject = document.getElementById("quiz-subject").value.trim();

  if (!newQuiz.title || !newQuiz.subject || !newQuiz.questions.length) {
    alert("Title, subject and at least 1 question required.");
    return;
  }

  let valid = true;
  document.querySelectorAll(".question-form").forEach((form, i) => {
    const text = form.querySelector(".q-text").value.trim();
    const a = form.querySelector(".opt-a").value.trim();
    const b = form.querySelector(".opt-b").value.trim();
    const c = form.querySelector(".opt-c").value.trim();
    const d = form.querySelector(".opt-d").value.trim();
    const correct = form.querySelector(".correct").value;
    const exp = form.querySelector(".explanation").value.trim();

    if (!text || !a || !b || !c || !d || !exp) {
      valid = false;
      return;
    }

    newQuiz.questions[i] = { ...newQuiz.questions[i], text, options: {A:a,B:b,C:c,D:d}, correct, explanation:exp };
  });

  if (!valid) {
    alert("Please complete all fields for every question.");
    return;
  }

  if (editingQuizId) {
    const idx = quizzes.findIndex(q => q.id === editingQuizId);
    quizzes[idx] = { ...newQuiz, id: editingQuizId, created: true };
  } else {
    newQuiz.id = Math.max(...quizzes.map(q=>q.id||0), 0) + 1;
    newQuiz.created = true;
    quizzes.push(newQuiz);
  }

  saveQuizzes();
  document.getElementById("create-screen").style.display = "none";
  document.getElementById("quizList").style.display = "grid";
  renderQuizzes("created");
};

// ────────────────────────────────────────────────
// Event Listeners
// ────────────────────────────────────────────────
document.addEventListener("click", e => {
  const t = e.target;
  const id = t.dataset.id ? Number(t.dataset.id) : null;

  // Filters
  if (t.matches(".filter-btn")) {
    document.querySelectorAll(".filter-btn").forEach(b=>b.classList.remove("active"));
    t.classList.add("active");
    renderQuizzes(t.dataset.filter);
  }

  // Create button
  if (t.id === "create-quiz-btn") startCreate();

  // Save for later
  if (t.classList.contains("save-quiz")) {
    if (!userData.saved.includes(id)) userData.saved.push(id);
    saveUserData();
    renderQuizzes();
  }

  // Remove pending
  if (t.classList.contains("remove-pending")) {
    userData.saved = userData.saved.filter(sid => sid !== id);
    saveUserData();
    renderQuizzes();
  }

  // Start / Re-attempt / View
  if (t.classList.contains("start-quiz") || t.classList.contains("reattempt")) {
    startAttempt(id, t.classList.contains("reattempt"));
  }
  if (t.classList.contains("view-results")) {
    const attempt = userData.attempts[id]?.slice(-1)[0];
    if (attempt) {
      currentQuiz = quizzes.find(q => q.id === id);
      userAnswers = attempt.answers;
      showResults(attempt.score);
    } else {
      alert("No attempt found.");
    }
  }

  // Edit / Delete
  if (t.classList.contains("edit-quiz")) startCreate(true, id);
  if (t.classList.contains("delete-quiz")) {
    if (confirm("Delete quiz?")) {
      quizzes = quizzes.filter(q => q.id !== id);
      delete userData.attempts[id];
      userData.saved = userData.saved.filter(s => s !== id);
      saveQuizzes();
      saveUserData();
      renderQuizzes();
    }
  }

  // Remove question in create
  if (t.classList.contains("remove-q")) {
    const idx = Number(t.dataset.index);
    newQuiz.questions.splice(idx, 1);
    renderNewQuestions();
  }

  // Back buttons
  if (t.id === "back-to-list" || t.id === "back-from-results" || t.id === "back-from-create") {
    document.getElementById("attempt-screen").style.display = "none";
    document.getElementById("results-screen").style.display = "none";
    document.getElementById("create-screen").style.display = "none";
    document.getElementById("quizList").style.display = "grid";
    renderQuizzes();
  }

  // Re-attempt from results
  if (t.id === "reattempt-btn") {
    document.getElementById("results-screen").style.display = "none";
    startAttempt(currentQuiz.id, true);
  }
});

// Initial render
renderQuizzes("all");
</script>
</body>
</html>